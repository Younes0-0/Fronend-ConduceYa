---
import Layout from '@layouts/Layout.astro';
import Footer from '@components/layout/Footer.astro';
import { SignOut } from 'auth-astro/components';
import { getSession } from 'auth-astro/server';

const session = await getSession(Astro.request);
if (!session) return Astro.redirect('/login');


const solicitud = [ 
  { nombre: "Juan Pérez", telefono: "123456789", sesion_preferida: "Mañana", teorico_aprobado: "", zona_nombre: "Zona 1", fecha_inscripcion: "2023-10-01T12:00:00Z", estado_display: "Aprobado" },
  { nombre: "María López", telefono: "987654321", sesion_preferida: "Tarde", teorico_aprobado: false, zona_nombre: "Zona 2", fecha_inscripcion: "2023-10-02T12:00:00Z", estado_display: "Pendiente" }
];
---

<Layout>
  
  <!-- Navbar + Offcanvas -->
  <nav class="navbar navbar-light bg-white shadow-sm mb-4">
    <div class="container-fluid">
      <button
        class="btn btn-outline-secondary"
        type="button"
        data-bs-toggle="offcanvas"
        data-bs-target="#offcanvasMenu"
        aria-controls="offcanvasMenu"
      >
        ☰
      </button>
      <a class="navbar-brand mx-auto" href="#">ConduceYa Admin</a>
      <div class="d-none d-md-flex align-items-center">
        <img
          src={session.user?.image}
          alt="Perfil"
          class="rounded-circle me-2"
          width="38"
          height="38"
        />
        <span class="text-secondary">{session.user?.name}</span>
      </div>
    </div>
  </nav>

  <div
    class="offcanvas offcanvas-start bg-white shadow"
    tabindex="-1"
    id="offcanvasMenu"
    aria-labelledby="offcanvasMenuLabel"
  >
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="offcanvasMenuLabel">ConduceYa</h5>
      <button
        type="button"
        class="btn-close text-reset"
        data-bs-dismiss="offcanvas"
        aria-label="Cerrar"
      ></button>
    </div>
    <div class="offcanvas-body p-0">
      <nav class="nav flex-column">
        <a class="nav-link px-3 py-2 text-secondary" href="/admin-dashboard">Dashboard</a>
        <a class="nav-link px-3 py-2 text-secondary" href="/usuarios">Usuarios</a>
        <a class="nav-link px-3 py-2 text-secondary" href="/citas">Citas</a>
        <a class="nav-link px-3 py-2 text-secondary" href="/configuracion">Configuración</a>
        <div class="px-3 py-2">
          <SignOut class="btn btn-link p-0 text-secondary">Cerrar sesión</SignOut>
        </div>
      </nav>
    </div>
  </div>

  <main class="container-fluid">
    <div class="row">
      <!-- Sidebar desktop -->
      <aside class="d-none d-md-block col-md-3 col-xl-2 bg-white vh-100 shadow-sm p-3">
        <h6 class="text-secondary">Admin</h6>
        <nav class="nav flex-column">
          <a class="nav-link text-secondary" href="/admin-dashboard">Dashboard</a>
          <a class="nav-link text-secondary" href="/usuarios">Usuarios</a>
          <a class="nav-link text-secondary" href="/citas">Citas</a>
          <a class="nav-link text-secondary" href="/configuracion">Configuración</a>
          <SignOut class="btn btn-link p-0 mt-2 text-secondary">Cerrar sesión</SignOut>
        </nav>
      </aside>

      <section class="col-12 col-md-9 col-xl-10">
        <h2 class="mb-4 text-secondary">
          Bienvenido, <span class="fw-semibold">{session.user?.name}</span>
        </h2>

        <div class="card shadow-sm mb-4">
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-hover align-middle mb-0">
                <thead class="table-light">
                  <tr>
                    <th>Nombre</th>
                    <th>Teléfono</th>
                    <th>Sesión Preferida</th>
                    <th>Teórico Aprobado</th>
                    <th>Zona</th>
                    <th>Fecha Inscripción</th>
                    <th>Estado</th>
                  </tr>
                </thead>
                <tbody>
                  {solicitud.map(s => (
                    <tr>
                      <td>{s.nombre}</td>
                      <td>{s.telefono}</td>
                      <td>{s.sesion_preferida}</td>
                      <td>{s.teorico_aprobado ? 'Sí' : 'No'}</td>
                      <td>{s.zona_nombre}</td>
                      <td>{new Date(s.fecha_inscripcion).toLocaleDateString('es-ES')}</td>
                      <td class={
                        s.estado_display === 'Aprobado' ? 'text-success fw-bold' :
                        s.estado_display === 'Pendiente' ? 'text-warning fw-bold' :
                        'text-danger fw-bold'
                      }>
                        {s.estado_display}
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
            <div class="d-flex justify-content-end mt-3">
              <button class="btn btn-primary">
                Comenzar
              </button>
            </div>
          </div>
        </div>
      </section>
    </div>
  </main>

  <Footer />

  <!-- Bootstrap JS + Popper -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</Layout>
