---
import Layout from '@layouts/Layout.astro';
import Menu from '@components/layout/Menu.astro';
import Footer from '@components/layout/Footer.astro';



const TOKEN = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzQ4NTIyODgxLCJpYXQiOjE3NDg1MTkyODEsImp0aSI6IjMxY2IzNmUwOGZjYjQxY2JhZWZmMGMwZDU5ZWY4NzgzIiwidXNlcl9pZCI6MX0.h-NAFeVsU8YUtS_ijop16Lv5SMo24g6IS5o60GznfGM";

const res = await fetch('http://localhost:8000/api/usuarios/users/', {
  headers: {
    'Authorization': `Bearer ${TOKEN}`
  }
});
const usuarios1 = await res.json();
---

<Layout title="Gestión de Usuarios">
  <Menu imageSrc="/img/logo-letras.png" imageAlt="logo de la empresa"/>
  <main class="container py-4">
    <h1 class="mb-4 text-primary fw-bold">Gestión de Usuarios</h1>
    <p class="mb-3 text-secondary">Aquí puedes ver, crear, editar o eliminar alumnos y usuarios del sistema.</p>
    <div class="table-responsive">
      <table class="table table-hover align-middle bg-white rounded-4 shadow-sm">
        <thead class="table-light">
          <tr>
            <th>ID</th>
            <th>Usuario</th>
            <th>Nombre</th>
            <th>Apellidos</th>
            <th>Rol</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          {usuarios1.results.map((usuario: { id: Number; username: String; first_name: String; last_name: String; rol: String; }) => (
            <tr>
              <td>{usuario.id}</td>
              <td>{usuario.username}</td>
              <td>{usuario.first_name}</td>
              <td>{usuario.last_name}</td>
              <td>
                <span class={`badge ${
                  usuario.rol === 'admin' ? 'bg-warning text-dark' :
                  usuario.rol === 'profesor' ? 'bg-info text-dark' :
                  'bg-primary'
                }`}>
                  {usuario.rol === 'admin' ? 'Admin' :
                   usuario.rol === 'profesor' ? 'Profesor' :
                   usuario.rol === 'A' ? 'Alumno' :
                   usuario.rol}
                </span>
              </td>
              <td>
                <a href={`/admin/usuarios/${usuario.id}`} class="btn btn-sm btn-outline-primary me-2">Ver</a>
                <a href={`/admin/usuarios/${usuario.id}/editar`} class="btn btn-sm btn-outline-secondary me-2">Editar</a>
                <button class="btn btn-sm btn-outline-danger">Eliminar</button>
              </td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
    <a href="/admin/usuarios/nuevo" class="btn btn-primary mt-3">Añadir Usuario</a>
  </main>
  <Footer/>
</Layout>
