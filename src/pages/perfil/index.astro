---
import Layout from '@layouts/Layout.astro';
import Menu from '@components/layout/Menu.astro';
import Footer from '@components/layout/Footer.astro';
import Hero from '@components/permisos/Hero.astro';
import { SignOut } from 'auth-astro/components';
import { getSession } from "auth-astro/server";
const session = await getSession(Astro.request);

if (!session) {
  return Astro.redirect("/admin-dashboard");
}
const usuario = {
  nombre: "Laura Sánchez",
  role: "alumno",
  email: "laura.sanchez@example.com",
  telefono: "612345678",
  date_joined: "2024-11-15T10:00:00Z",
  progresoTeorico: 65,
  clasesCompletadas: 14,
  proximasClases: [
    {
      id: 1,
      fecha: "2025-05-23",
      hora: "10:00",
      instructor: "Carlos M.",
      tipo: "Pista"
    },
    {
      id: 2,
      fecha: "2025-05-26",
      hora: "12:30",
      instructor: "Eva G.",
      tipo: "Circulación"
    }
  ],
  historialClases: [
    {
      fecha: "2025-05-15",
      estado: "Asistida",
      instructor: "Carlos M.",
      tipo: "Teórica"
    },
    {
      fecha: "2025-05-18",
      estado: "No asistida",
      instructor: "Eva G.",
      tipo: "Pista"
    }
  ]
};
---

<Layout title="Mi Perfil">
  <Menu imageSrc="/img/logo-letras.png" imageAlt="logo de la empresa"/>
  <Hero 
    title={session.user?.name || usuario.nombre}
    subtitle={usuario.role}
    buttonText="Editar Perfil"
    buttonLink="/editar-perfil"
    imageSrc="./img/hero-image.jpg"
  />
  <main class="container py-4">
    <div class="row g-4">
      <div class="col-md-6">
        <div class="card shadow rounded-4">
          <div class="card-body">
            <h2 class="card-title h5 border-bottom pb-2 mb-3 text-primary">Información Personal</h2>
            <ul class="list-unstyled mb-0">
              <li class="mb-2">
                <strong class="text-secondary">Email:</strong> {session.user?.email || usuario.email}
              </li>
              <li class="mb-2">
                <strong class="text-secondary">Teléfono:</strong> {usuario.telefono}
              </li>
              <li class="mb-2">
                <strong class="text-secondary">Fecha de registro:</strong> {new Date(usuario.date_joined).toLocaleDateString('es-ES')}
              </li>
              <li class="mb-2">
                <strong class="text-secondary">Tipo de usuario:</strong>
                <span class="badge bg-info text-dark ms-2 text-capitalize">{usuario.role}</span>
              </li>
            </ul>
          </div>
        </div>
      </div>

      <div class="col-md-6">
        <div class="card shadow rounded-4">
          <div class="card-body">
            <h2 class="card-title h5 border-bottom pb-2 mb-3 text-primary">Progreso</h2>
            <div class="mb-3">
              <div class="progress" style="height: 1.5rem;">
                <div 
                  class="progress-bar progress-bar-striped bg-primary fw-bold" 
                  style={`width: ${usuario.progresoTeorico}%`}
                  role="progressbar" 
                  aria-valuenow={usuario.progresoTeorico} 
                  aria-valuemin="0" 
                  aria-valuemax="100"
                >
                  {usuario.progresoTeorico}%
                </div>
              </div>
            </div>
            <p>Clases completadas: <span class="fw-bold">{usuario.clasesCompletadas}</span></p>
            <p>Clases restantes: <span class="fw-bold">{100 - usuario.progresoTeorico}%</span></p>
            <SignOut class="btn btn-outline-primary w-100 mt-3">Cerrar sesión</SignOut>
          </div>
        </div>
      </div>

      <div class="col-md-6">
        <div class="card shadow rounded-4">
          <div class="card-body">
            <h2 class="card-title h5 border-bottom pb-2 mb-3 text-primary">Próximas Clases</h2>
            <ul class="list-group">
              {usuario.proximasClases.map(clase => (
                <li class="list-group-item d-flex flex-column flex-md-row align-items-md-center justify-content-between">
                  <div>
                    <span class="fw-semibold me-3">{clase.fecha}</span>
                    <span class="badge bg-secondary me-2">{clase.hora}</span>
                  </div>
                  <div>
                    <span class="me-2 text-muted">Instructor: <span class="fw-medium">{clase.instructor}</span></span>
                    <span class="me-2 text-muted">Tipo: <span class="fw-medium">{clase.tipo}</span></span>
                  </div>
                  <button class="btn btn-danger btn-sm ms-md-2 mt-2 mt-md-0" disabled>Cancelar</button>
                </li>
              ))}
            </ul>
          </div>
        </div>
      </div>

      <div class="col-md-6">
        <div class="card shadow rounded-4">
          <div class="card-body">
            <h2 class="card-title h5 border-bottom pb-2 mb-3 text-primary">Historial de Clases</h2>
            <ul class="list-group">
              {usuario.historialClases.map(clase => (
                <li class="list-group-item d-flex flex-column flex-md-row align-items-md-center justify-content-between bg-light">
                  <div>
                    <span class="fw-semibold me-3">{clase.fecha}</span>
                    <span class="badge bg-success me-2">{clase.estado}</span>
                  </div>
                  <div>
                    <span class="me-2 text-muted">Instructor: <span class="fw-medium">{clase.instructor}</span></span>
                    <span class="me-2 text-muted">Tipo: <span class="fw-medium">{clase.tipo}</span></span>
                  </div>
                </li>
              ))}
            </ul>
          </div>
        </div>
      </div>
    </div>
  </main>
  <Footer/>
</Layout>
