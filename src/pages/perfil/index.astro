---
import Layout from '@layouts/Layout.astro';
import Menu from '@components/layout/Menu.astro';
import Footer from '@components/layout/Footer.astro';
import Hero from '@components/permisos/Hero.astro';
import {SignOut} from 'auth-astro/components';
import { getSession } from "auth-astro/server";
const session = await getSession(Astro.request);

if (!session) {
  return Astro.redirect("/login");
}
const usuario = {
  nombre: "Laura Sánchez",
  role: "alumno",
  email: "laura.sanchez@example.com",
  telefono: "612345678",
  date_joined: "2024-11-15T10:00:00Z",
  progresoTeorico: 65,
  clasesCompletadas: 14,
  proximasClases: [
    {
      id: 1,
      fecha: "2025-05-23",
      hora: "10:00",
      instructor: "Carlos M.",
      tipo: "Pista"
    },
    {
      id: 2,
      fecha: "2025-05-26",
      hora: "12:30",
      instructor: "Eva G.",
      tipo: "Circulación"
    }
  ],
  historialClases: [
    {
      fecha: "2025-05-15",
      estado: "Asistida",
      instructor: "Carlos M.",
      tipo: "Teórica"
    },
    {
      fecha: "2025-05-18",
      estado: "No asistida",
      instructor: "Eva G.",
      tipo: "Pista"
    }
  ]
};
---


<Layout title="Mi Perfil">
  <Menu imageSrc="/img/logo-letras.png" imageAlt="logo de la empresa"/>
  <Hero 
    title={usuario.nombre}
    subtitle={usuario.role}
    buttonText="Editar Perfil"
    buttonLink="/editar-perfil"
    imageSrc="./img/hero-image.jpg"
  />
  <main class="perfil-container">
    
    <section class="perfil-grid">
      <article class="seccion">
        <h2>Información Personal</h2>
        <div class="info-personal">
          <div class="campo">
            <span class="etiqueta">Email:</span>
            <span>{usuario.email}</span>
          </div>
          <div class="campo">
            <span class="etiqueta">Teléfono:</span>
            <span>{usuario.telefono}</span>
          </div>
          <div class="campo">
            <span class="etiqueta">Fecha de registro:</span>
            <span>{new Date(usuario.date_joined).toLocaleDateString('es-ES')}</span>
          </div>
          <div class="campo">
            <span class="etiqueta">Tipo de usuario:</span>
            <span class="tipo-usuario">{usuario.role}</span>
          </div>
        </div>
      </article>

      <article class="seccion">
        <h2>Progreso</h2>
        <div class="progreso">
          <div class="barra-progreso">
            <div class="progreso-completado" style={`width: ${usuario.progresoTeorico}%`}>
              <span>{usuario.progresoTeorico}%</span>
            </div>
          </div>
          <p>Clases completadas: <span>{usuario.clasesCompletadas}</span></p>
          <p>Clases restantes: <span>{100 - usuario.progresoTeorico}%</span></p>
          <SignOut class="btn btn-primary btn-lg">Cerrar sesión</SignOut>
        </div>
      </article>

      <article class="seccion">
        <h2>Próximas Clases</h2>
        <div class="lista-clases">
          {usuario.proximasClases.map(clase => (
            <div>
              <div class="clase-card">
                <div class="clase-info">
                  <strong>{clase.fecha}</strong>
                  <span>{clase.hora}</span>
                </div>
                <div class="clase-detalles">
                  <p>Instructor: {clase.instructor}</p>
                  <p>Tipo: {clase.tipo}</p>
                </div>
              </div>
              <button class="btn-cancelar" disabled>Cancelar</button>
            </div>
          ))}
        </div>
      </article>

      <article class="seccion">
        <h2>Historial de Clases</h2>
        <div class="lista-clases">
          {usuario.historialClases.map((clase, index) => (
            <div class="clase-card historico">
              <div class="clase-info">
                <strong>{clase.fecha}</strong>
                <span class="estado">{clase.estado}</span>
              </div>
              <div class="clase-detalles">
                <p>Instructor: {clase.instructor}</p>
                <p>Tipo: {clase.tipo}</p>
              </div>
            </div>
          ))}
        </div>
      </article>
    </section>
  </main>
  <Footer/>
</Layout>


<style>
  body {
    background-color: #f3f4f6;
    color: #374151;
  }
  .perfil-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem;
  }

  .perfil-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
  }

  .perfil-info h1 {
    color: #1f2937;
    margin-bottom: 0.5rem;
  }

  .tipo-usuario {
    color: #6b7280;
    text-transform: capitalize;
  }


  .perfil-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 2rem;
  }

  .seccion {
    background: white;
    padding: 1.5rem;
    border-radius: 1rem;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  }

  .seccion h2 {
    color: #1f2937;
    margin-bottom: 1.5rem;
    border-bottom: 1px solid #e5e7eb;
    padding-bottom: 0.5rem;
  }

  .info-personal .campo {
    display: flex;
    margin-bottom: 1rem;
  }

  .etiqueta {
    font-weight: 500;
    width: 150px;
    color: #6b7280;
  }

  .barra-progreso {
    background: #e5e7eb;
    border-radius: 1rem;
    height: 1.5rem;
    overflow: hidden;
    margin-bottom: 1rem;
  }

  .progreso-completado {
    background: var(--primary-color);
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 0.875rem;
    transition: width 0.3s ease;
  }

  .lista-clases {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .clase-card {
    border: 1px solid #e5e7eb;
    border-radius: 0.5rem;
    padding: 1rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .clase-info {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .clase-detalles {
    color: #6b7280;
  }

  .btn-cancelar {
    background-color: #ef4444;
    color: white;
    padding: 0.5rem 1rem;
    border: none;
    border-radius: 0.5rem;
    cursor: pointer;
    transition: background-color 0.2s;
  }

  .btn-cancelar:hover {
    background-color: #dc2626;
  }

  .historico {
    background: #f9fafb;
  }

  .estado {
    color: #10b981;
    font-size: 0.875rem;
  }

  @media (max-width: 768px) {
    .perfil-grid {
      grid-template-columns: 1fr;
    }

    .clase-card {
      flex-direction: column;
      gap: 1rem;
      text-align: center;
    }
  }

  .loading-spinner {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 50vh;
    font-size: 1.2rem;
    color: #6b7280;
  }
</style>